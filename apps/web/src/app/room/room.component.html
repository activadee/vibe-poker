<div class="room">
  <h2>Room {{ roomId() }}</h2>

  @if (error()) {
    <div class="error">
      {{ error() }}
      <div class="actions">
        <a routerLink="/" class="btn">Create a new room</a>
      </div>
    </div>
  }

  @if (!joined()) {
    <div class="join">
      <label>
        Your name
        <input [(ngModel)]="name" (keyup.enter)="join()" placeholder="Alice" />
      </label>
      <button class="btn primary" (click)="join()">Join Room</button>
    </div>
  }

  @if (joined()) {
    <div class="room-actions">
      <button class="btn secondary" (click)="leave()">Leave Room</button>
    </div>
    <div class="share">
      <p>Share this link with your team:</p>
      <div class="link">
        <code>{{ url }}</code>
        <button (click)="copyLink()">Copy Link</button>
      </div>
      @if(copied()) {
        <p class="copied">Link copied!</p>
      }
    </div>

    <div class="participants">
      <h3>Participants</h3>
      <div class="progress-pill" *ngIf="voteTotal() > 0">
        {{ voteCount() }}/{{ voteTotal() }} voted
      </div>
      <ul>
        @for (p of participants(); track p.id) {
          <li>
            <span class="name">{{ p.name }}</span>
            <span class="role">{{ p.role }}</span>
            <span class="badge voted" *ngIf="hasVoted(p)">Voted</span>
            <span class="vote" *ngIf="revealed(); else hiddenVote">{{ votes()[p.id] ?? '—' }}</span>
            <ng-template #hiddenVote>
              <span class="vote muted">—</span>
            </ng-template>
          </li>
        }
      </ul>
    </div>

    <div class="voting">
      <h3>Vote</h3>
      <div class="deck">
        @for (c of deck; track c) {
          <button class="card" [disabled]="myRole() === 'observer'" (click)="castVote(c)">{{ c }}</button>
        }
      </div>
      @if (myRole() === 'observer') {
        <p class="hint">Observers cannot vote</p>
      }
    </div>

    @if (myRole() === 'host') {
      <div class="host-controls">
        <h3>Host Controls</h3>
        <div class="controls">
          <button class="btn primary" (click)="reveal()">Reveal</button>
          <button class="btn" (click)="resetVotes()">Reset</button>
        </div>
      </div>
    }
  }
</div>
